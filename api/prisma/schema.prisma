generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Business {
  id           String @id @default(cuid())
  name         String
  openedTicket Chat[]
}

model User {
  id       String @id
  user     String @unique
  password String
  role     Roles
}

model Customer {
  id    String  @id
  name  String?
  phone String
  chats Chat[]
}

model Chat {
  id            String         @id @default(cuid())
  customerId    String
  updatedAt     DateTime       @updatedAt
  createdAt     DateTime       @default(now())
  businessId    String?
  contactReason ContactReason?
  currentStep   Steps
  closedAt      DateTime?
  startedBy     SenderType?
  status        ChatStatus
  business      Business?      @relation(fields: [businessId], references: [id])
  customer      Customer       @relation(fields: [customerId], references: [id])
  messages      Message[]
}

model Message {
  id        String     @id @default(cuid())
  chatId    String
  sender    SenderType
  content   String
  createdAt DateTime   @default(now())
  chat      Chat       @relation(fields: [chatId], references: [id], onDelete: Cascade)
}

enum SenderType {
  CUSTOMER
  BOT
  AGENT
}

enum Steps {
  business_redirect
  contact_reason
  place_order_pizza
  place_order_burger
  place_order_fihass
  report_problem
  attendant
  started
}

enum ContactReason {
  order
  problem
  feedback
}

enum Roles {
  manager
  attendant
}

enum ChatStatus {
  open
  finished
  unfinished
}
